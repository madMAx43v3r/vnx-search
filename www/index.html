<!DOCTYPE html>
<html>
<head>
<title>fcknwo.com - Search Engine</title>
<style>
	body {
		margin: 20px;
	}
	.item {
		margin-top: 30px;
		margin-bottom: 30px;
	}
	.title {
		font-size: 120%;
		line-height: 150%;
	}
	.url {
		color: rgb(0,100,0);
	}
	.date {
		color: rgb(0,0,0);
	}
	.context {
		color: rgb(50,50,50);
	}
	#stats {
		color: rgb(80,80,80);
		font-size: 100%
	}
</style>
</head>
<body>

<form onsubmit="submit_query(); return false">
	<span style="font-size: 100%;">Search: </span>
	<input id="query" type="text" value="" style="font-size: 100%;" size="40">
	<input type="submit" value="Submit" style="font-size: 100%;">
</form>

<div id="results"></div>

<div id="stats" style="display: none">
<hr>
Load: <span id="load_time">???</span> ms | 
Compute: <span id="compute_time">???</span> ms |
Total: <span id="total_time">???</span> ms
</div>

<script language="javascript">
var input = document.getElementById("query");
var output = document.getElementById("results");

function on_result()
{
	if(this.status != 200) {
		output.innerHTML = "HTTP Error: " + this.status;
		return;
	}
	var json = this.responseText.replace(/\t/g, ' ');
	var result = JSON.parse(json);
	//console.log(json);
	
	output.innerHTML = "";
	
	for(var i = 0; i < result.items.length; ++i)
	{
		var item = result.items[i];
		var date = new Date(item.last_modified * 1000);
		var div = document.createElement("div");
		var url_str = item.url.replace(/(^\w+:|^)\/\//, '');
		var title = item.title;
		if(!title.length) {
			title = url_str;
		}
		div.className = "item";
		div.innerHTML = `
			<span class="url">${url_str}</span><br>
			<a class="title" href="${item.url}" target="_blank">${title}</a><br>
			<span class="date">${date.toDateString()} | </span>
			<span class="context">${item.context}</span><br>
		`
		output.appendChild(div);
	}
	if(!result.items.length) {
		output.innerHTML = "<br>No Results!";
	}
	
	document.getElementById("load_time").textContent = result.load_time_us / 1000;
	document.getElementById("compute_time").textContent = result.compute_time_us / 1000;
	document.getElementById("total_time").textContent = (result.load_time_us + result.compute_time_us) / 1000;
	document.getElementById("stats").style.display = "block";
}

function submit_query()
{
	output.innerHTML = "<br>Loading ...";
	document.getElementById("stats").style.display = "none";
	
	var req = new XMLHttpRequest();
	req.addEventListener("load", on_result);
	req.open("GET", "/search/query?t=" + encodeURIComponent(input.value));
	req.send(null);
}
</script>

</body>
</html>
